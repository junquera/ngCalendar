<html>
    <head>
      <!-- Latest compiled and minified CSS -->
      <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

      <!-- Optional theme -->
      <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">

        <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.5/angular.min.js"></script>
        <script>
          var app = angular.module("myApp", []);
          class Calendario extends Date {

            get day() {
              return this.getUTCDate();
            }

            get month() {
              return this.getUTCMonth();
            }

            get year() {
               return this.getUTCFullYear();
            }

            get week_day() {
               return this.getUTCDay();
            }

            set day(v)  {
              this.setUTCDate(v);
            }

            set month(v) {
              this.setUTCMonth(v);
            }

            set year(v) {
               this.setUTCFullYear(v);
            }

            nextDay() {
              this.day = this.day + 1;
            }

            previousDay() {
              this.day = this.day - 1;
            }

            nextMonth() {
              this.month = this.month + 1;
            }

            previousMonth() {
              this.month = this.month - 1;
            }

            nextYear() {
              this.year = this.year + 1;
            }

            previousYear() {
              this.year = this.year - 1;
            }

            get month_text() {
              return ['ENE', 'FEB', 'MAR', 'ABR', 'MAY', 'JUN', 'JUL', 'AGO', 'SEP', 'OCT', 'NOV', 'DIC'][this.month]
            }

            get array() {
              // TODO Add padding row if the calendar has more than a week of the next month at the end
              var aux = new Calendario(this);

              while( aux.day > 1 ){
                aux.previousDay();
              }

              // > 1 because monday is 0
              while( aux.week_day > 1 ){
                aux.previousDay();
              }

              var result = [];
              for(let i = 0; i < 6; i++){
                var rows = [];
                for(let j = 0; j < 7; j++){
                  rows.push(aux.day);
                  aux.nextDay();
                }
                result.push(rows);
              }

              return result;
            }
          };

          var f = new Calendario();
          app.controller("MainController", function($scope){
            $scope.app = "Calendario";
          });
          // https://docs.angularjs.org/guide/directive
          app.directive("myCal",function(){
              var d = new Date();
              var today = {
                day: d.getUTCDate(),
                month: d.getUTCMonth(),
                year: d.getUTCFullYear(),
                week_day: d.getUTCDay(),

              }
              var f = new Calendario();
              return {
                restrict: 'E',
                templateUrl: 'cal-template.html',
                controller: function($scope){
                  $scope.dir = "Hola";
                  $scope.fecha = new Calendario();
                }
              };
          });
        </script>
    </head>
    <body ng-app="myApp" ng-controller="MainController">
      <h1>{{ app }}</h1>
      <my-cal></my-cal>


    </body>

</html>
